<script>
    function readURL(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
          $('#img_prev')
            .attr('src', e.target.result);
            // .width(450)
            // .height(200);
        };

        reader.readAsDataURL(input.files[0]);
        document.getElementById("image_type").value = "file";
      }
    }

    function readPresetImage(input){
    	if (input) {
    		var output = document.getElementById('img_prev');
    		console.log(input.value);
		    // output.src = URL.createObjectURL(input.value);
		    $('#img_prev').attr('src', input.value);
		    document.getElementById("image_type").value = "url";
    	}
    }

    function preview(){
    	first_dj = $('#first_dj').val();
    	second_dj = $('#second_dj').val();
    	last_call = $('#pending_last_call').val();
    	last_call_as = $('#pending_last_call_as').val();
    	console.log(last_call)
    	admission_fee = $('#admission_fee').val();
    	drink_special = $('#drink_special').val();
    	description = $('#description').val();
    	$("div#first_dj_div").text(first_dj);
    	$("div#second_dj_div").text(second_dj);
    	$("span#last_call_div").text(last_call);
    	$("span#last_call_as_div").text(last_call_as);
    	$("div#admission_fee_div").text(admission_fee);
    	$("div#drink_special_div").text(drink_special);
    	$("div#description_div").text(description);

    	if (first_dj || second_dj || last_call || last_call_as || admission_fee || drink_special || description){
    		if ((first_dj || second_dj) && (last_call || last_call_as || admission_fee || drink_special)){
    			document.getElementById("first-hr").style.display = 'block';
			}
    		else{
    			document.getElementById("first-hr").style.display = 'none';
    		}

    		if (description && (last_call || last_call_as || admission_fee || drink_special)){
    			document.getElementById("second-hr").style.display = 'block';
			}
    		else{
    			document.getElementById("second-hr").style.display = 'none';
    		}

    		document.getElementById("venue-title-div").style.display = 'block';
    	}
    	else{
		    document.getElementById("venue-title-div").style.display = 'none';
    	}

    }
</script>




<% content_for :title, "Yero -  Venues" %>


<%if @device == "mobile"%>
<div class="off-canvas-wrap" data-offcanvas>
<%else%>
<div class="off-canvas-wrap move-right" data-offcanvas>
<%end%>
  <div class="inner-wrap">
    <nav class="tab-bar">
      <section class="left-small">
        <a class="left-off-canvas-toggle menu-icon" href="#"><span></span></a>
      </section>
      <section class="middle tab-bar-section">
        <h3 class="title">Greeting Message</h3>
      </section>
    </nav>

    <aside class="left-off-canvas-menu">
      <%= render "/venues/sidebar", current: "greeting-message", venue_id: @venue.id %>
    </aside>

    <section class="main-section">
    	<p></p>
      	<p id="notice"><%= notice %></p>
      <!-- content goes here -->
      	<div class="index-title"><%=@venue.name%> | Greeting Message</div>

      	<%= render "day_picker", current: @day.weekday_title, venue_id: @venue.id %>
		<hr class="top-divider">

		<div class="medium-12 medium-offset-1 columns">
      		<%= form_for(@greeting_message) do |f| %>
			<div class="message-edit-form"  style="width: 20%; float:left">
			  <% if @greeting_message.errors.any? %>
			    <div id="error_explanation">
			      <h2><%= pluralize(@greeting_message.errors.count, "error") %> prohibited this greeting_message from being saved:</h2>

			      <ul>
			      <% @greeting_message.errors.full_messages.each do |msg| %>
			        <li><%= msg %></li>
			      <% end %>
			      </ul>
			    </div>
			  <% end %>

			   <!-- <div class="venue-sub-title">Venue Info</div> -->
			   <div class="venue-fields">
			   	<% images_array =  PresetGreetingImage.all.where(:is_active => true) %>
			   	
			   	<% images_array.each do |image|%>
			   		<input type="radio" name="image" id="image_<%=image.id%>" value="<%=image.avatar.url%>" onchange="readPresetImage(this)">
			   		<%= image_tag(image.avatar.url) %>

			   	<% end %>
			   	<%= hidden_field_tag 'image_type', 'none' %>
			   	<%= f.file_field :poster, {:onchange => "readURL(this)"} %>
			   	
			    <p>Tonight's Lineup</p>
			    <%= f.text_field :pending_first_dj, {:id => "first_dj", :onkeyup => "preview()", :placeholder => "Act #1 ex.DJ 1 (House) 10-1"} %>
			    <%= f.text_field :pending_second_dj, {:id => "second_dj", :onkeyup => "preview()", :placeholder => "Act #2"} %>
			    <hr> 
			   
			    Last call @ &emsp;
			    <%@time_options = ["00:00", "00:30", "01:00", "01:30", "02:00", "02:30", "03:00", "03:30", "04:00", "04:30", "05:00", "05:30", "06:00", "06:30", "07:00", "07:30", "08:00", "08:30", "09:00", "09:30", "10:00", "10:30", "11:00", "11:30"]%>
			    <%= select_tag :pending_last_call, options_for_select(@time_options, @greeting_message.pending_last_call), :onchange => "preview()", :include_blank => "hh:mm" %>
			    &emsp;
			    <%@as_options = ["AM", "PM"]%>
			    <%= select_tag :pending_last_call_as, options_for_select(@as_options, @greeting_message.pending_last_call_as), :onchange => "preview()", :include_blank => "" %>
			    <br>
			   
			    $ &emsp;
			    <%= f.number_field :pending_admission_fee, {:step => 0.01, :id => "admission_fee", :onkeyup => "preview()", :style => "display:inline-block; width:120px"} %>
			    &emsp;Admission
			    <br>
			    <%= f.text_field :pending_drink_special, {:id => "drink_special", :onkeyup => "preview()", :placeholder => "Drink Special go here"} %>
				<hr>

			    <%= f.text_area :pending_description, {:id => "description", :onkeyup => "preview()", :placeholder => "Use this space for anything", :style => "height: 120px;resize:vertical;"} %>
			   </div>







			</div>
			<div style="width: 10%; float:left">&emsp;</div>
			<div class="preview"  style="width: 30%; float:left">
				<h4>Preview</h4>
			   	<%if @greeting_message.greeting_posters.blank? %>
					<%= image_tag("Logo_green.png", :alt => "Preview", :id => "img_prev") %>
				<% else %>
					<%= image_tag(@greeting_message.poster.avatar.url, :alt => "Preview", :id => "img_prev") %>
				<% end %>
				<div class="preview-inner-text">
					<div id="venue-title-div"><%=@venue.name%></div>
					<div id="first_dj_div"><%=@greeting_message.pending_first_dj %></div>
					<div id="second_dj_div"><%=@greeting_message.pending_second_dj %></div>
					<%if (@greeting_message.pending_first_dj.present? || @greeting_message.pending_second_dj.present?) && (@greeting_message.pending_last_call.present? || @greeting_message.pending_last_call_as.present? || @greeting_message.pending_admission_fee.present? || @greeting_message.pending_drink_special.present?)%>
						<hr id="first-hr" class="preview hr" style="display:block">
					<%else%>
						<hr id="first-hr" class="preview hr" style="display:none">
					<%end%>						
					<span id="last_call_div"><%=@greeting_message.pending_last_call %></span>
					<span id="last_call_as_div"><%=@greeting_message.pending_last_call_as %></span>
					<div id="admission_fee_div"><%=@greeting_message.pending_admission_fee %></div>
					<div id="drink_special_div"><%=@greeting_message.pending_drink_special %></div>
					<%if (@greeting_message.pending_description.present?) && (@greeting_message.pending_last_call.present? || @greeting_message.pending_last_call_as.present? || @greeting_message.pending_admission_fee.present? || @greeting_message.pending_drink_special.present?)%>
						<hr id="second-hr" class="preview hr" style="display:block">
					<%else%>
						<hr id="second-hr" class="preview hr" style="display:none">
					<%end%>

					<div id="description_div"><%=@greeting_message.pending_description %></div>
				</div>
			    <div class="venue-fields">
				   <%= f.submit "SAVE ALL CHANGES", :class => "button small", data: { disable_with: "Please wait..."}%>
				</div>
		    </div>
			<%end%>
		</div>
    </section>

  <a class="show-for-small-only exit-off-canvas"></a>

  </div>
</div>

